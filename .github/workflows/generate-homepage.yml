name: Generate Homepage

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Generate index.html
      run: |
        echo "<!DOCTYPE html>" > index.html
        echo "<html><head><meta charset='UTF-8'><title>Index</title>" >> index.html
        echo "<style>body{font-family:sans-serif;padding:20px;} a{display:block;margin:8px 0;}</style></head><body>" >> index.html
        echo "<h1>Available Lessons</h1>" >> index.html
        echo "<ul>" >> index.html

        # Find all HTML files (exclude index.html itself)
        for file in $(find . -name "*.html" ! -name "index.html" | sort); do
          clean=${file#./}
          echo "<li><a href=\"$clean\">$clean</a></li>" >> index.html
        done

        echo "</ul></body></html>" >> index.html

    - name: Commit updated index.html
      run: |
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git add index.html
        git commit -m "Auto-generate homepage" || echo "No changes to commit"
        git push
