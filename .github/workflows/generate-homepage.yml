name: Generate Homepage

on:
  push:
    branches: [main]

permissions:
  contents: write   # <-- REQUIRED to allow git push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        persist-credentials: true   # <-- ensure the bot's token stays configured

    - name: Generate index.html
      run: |
        echo "<!DOCTYPE html>" > index.html
        echo "<html><head><meta charset='UTF-8'><title>Index</title>" >> index.html
        echo "<style>
                body { font-family: sans-serif; padding: 20px; }
                ul { list-style: none; padding: 0; }
                li { margin: 12px 0; }
                a {
                  display: block;
                  padding: 14px 18px;
                  background: #f4f4f4;
                  border-radius: 8px;
                  text-decoration: none;
                  color: #333;
                  font-size: 18px;
                }
                a:hover {
                  background: #e0e0e0;
                }
              </style></head><body>" >> index.html
                echo "<h1>Available Lessons</h1>" >> index.html
                echo "<ul>" >> index.html

        for file in $(ls lessons/*.html 2>/dev/null | sort); do
          clean=${file#lessons/}              # remove folder path
          name=${clean%.html}                 # remove extension
          echo "<li><a href=\"$file\">$name</a></li>" >> index.html
        done

        echo "</ul></body></html>" >> index.html

    - name: Commit updated index.html
      run: |
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git add index.html
        git commit -m "Auto-generate homepage" || echo "No changes to commit"
        git push
